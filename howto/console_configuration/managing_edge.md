# 管理Edge

为使用Edge作为网关收集数据以及其他各项功能，你需要在 **Edge网关 > Edge管理** 中创建该Edge，并配置相应的通信参数。

## 开始前准备

- 有Edge管理操作权限，如果没有需联系组织管理员添加。有关EnOS内的用户权限，参见[策略，角色，与权限](/docs/iam/zh_CN/latest/access_policy)。
- 完成Edge模型、产品和设备的创建。参见[设备管理](/docs/device-connection/zh_CN/latest/device_management_overview)。Edge模型的模型名称必须为 **EnOS_Edge_Standard_Model**， Edge产品的产品名称必须为 **EnOS_Edge_Standard_Product**。

## 添加Edge

1. 选择 **Edge网关 > Edge管理**；

2. 点击 **添加** ，在“添加Edge”窗口的列表中，从已创建好的Edge设备中，选择需要注册的Edge设备，点击**确定**，完成Edge设备的添加

## 添加连接

添加Edge设备后，下一步为Edge添加连接。在添加好的Edge设备的操作栏，点击 **查看** ，选择 **接入管理** ， 可以在“以太网”和“串口”两个标签页根据需要，点击 **添加连接** 。

### 添加以太网连接

点击 **添加连接** 后，需要填入以下字段：

.. csv-table::
   :widths: auto

   "字段", "说明"
   "连接名称", "连接的标识符"
   "模式", "目前支持TCP/IP客户端、TCP/IP服务端、HTTP(s)客户端、HTTP(s)服务端、UDP及其他"
   "是否为短连接", "用于决定当前连接是长连接还是短连接，用户可自主设定，默认为长连接"
   "地址（主）", "不同模式下的含义见下文"
   "地址（备）", "不同模式下的含义见下文"
   "规约类型", "需先选择“规约类型”，而后才可以选择对应规约类型下的具体规约程序"
   "规约", "下拉列表中选择对应规约类型下的具体规约程序"
   "配置文件", "选择了具体规约之后，可以下载标准模板文件，根据需要修改模板参数后再上传"

地址（主）在不同模式下的含义如下：

- TCP/IP客户端：填写对端（TCP/IP服务端）的IP和端口号，表示要连接的对端服务器的主地址；
- TCP/IP服务端：填写对端（TCP/IP客户端）的IP和端口号；表示允许连接本Edge的对端客户端的主地址；
- HTTP(s)客户端：填写对端（HTTP(s)服务端）主地址；
- HTTP(s)服务端：填写Edge端本地地址和端口号，格式形如172.0.0.0:端口号；
- UDP：在UDP模式下会存在“对端地址(主)”和“本机地址(主)”两个参数，用户需分别填写对端和本地的IP和端口号，表示连接双方的主地址；
- 其他：面向特殊模式的连接，当存在不属于上述各模式的连接时，请咨询Edge团队该参数的具体填写方式。

地址（备）在不同模式下的含义如下：

- TCP/IP客户端：填写对端（TCP/IP服务端）的IP和端口号，表示要连接的对端服务器的备用地址，当对端主地址异常时，Edge会自动切换连接该备用地址；
- TCP/IP服务端：填写对端（TCP/IP客户端）的IP和端口号；表示允许连接本Edge的对端客户端的备用地址，当对端主地址连接异常时，允许对端以此备用地址连接Edge；
- HTTP(s)客户端：该模式下暂不支持备用地址，无需填写；
- HTTP(s)服务端：该模式下暂不支持备用地址，无需填写；
- UDP：在UDP模式下会存在“对端地址(备)”和“本机地址(备)”两个参数，用户需分别填写对端和本地的IP和端口号，表示连接双方的备用地址；
- 其他：该模式下暂不支持备用地址，无需填写

### 添加串口连接

添加串口连接需要填入以下字段：

- 连接名称
- 串口号
- 波特率
- 数据位
- 校验位
- 停止位
- 规约类型
- 规约
- 配置文件

## 添加设备

添加完连接之后，你应当在连接下添加设备。

点击连接，选择 **添加设备** 。在此页面中需先选择对应的产品，而后选择该产品下的设备，而后为所选设备选择设备模板，点击保存按钮后完成设备添加操作

## 编辑设备

你可以点击相应设备操作栏的 |edit| 来编辑设备信息；如果需要批量编辑设备信息，可以在连接处选择 **导出** 然后在下载的设备列表中进行批量编辑，如下图所示：

.. |edit| image:: ../../media/button_edit.png

.. image:: ../../media/editing_device_in_batch.png

### 配置逻辑地址或偏移量

由于一条连接下接入了多个设备，因此需为每个设备配置其逻辑编号及各类点的偏移量。其配置方法取决于所采用的通信规约及其设置。可以逐个设备进行配置，也可导出设备连接信息表线下配置完成后再导入系统，实现批量配置。

1. 逐个设备进行配置

   点击设备后的 |018| 图标，可对此台设备进行编辑，如下图所示：

   .. |018| image:: ../../media/editing_device_button.png

   .. image:: ../../media/configuring_local_address.png
      :alt: 图：逐个设备配置逻辑编号及偏移量

2. 批量配置

   点击连接下的导出按钮，下载连接信息表填写后，再点击导入按钮上传信息表，如下图所示：

   .. image:: ../../media/batch_configuring_local_address.png
      :alt: 图：设备连接信息表

.. note:: 导出的表中支持AI，DI，PI，AO，DO，PO偏移量的配置。基本的配置方式为用短划线连接，如0-50，当同时存在多个偏移量时，可用\#隔离，如0-50\#1000-1050。


## 转发数据

你也可以根据需求，将Edge收集到的数据转发给第三方系统。设置数据转发的步骤与连接Edge和EnOS的步骤类似，包括添加连接、添加设备、配置连接相关参数。EnOS支持以下使用以下规约进行数据转发：

- IEC104

### 使用IEC104转发数据

1. 点击 **添加设备** ，填写以下字段后点击确定：

   - 连接名称
   - 连接模式
   - 地址
   - 规约
   - 配置文件：可以根据需要，下载配置文件并修改后再上传

2. 点击连接，选择 **添加设备** ， 使用设备模型和产品筛选处需要添加的设备，点击 **保存** ；

3. 为设备选择转发模板，点击 **保存**

   在完成添加设备后，系统会根据添加设备的顺序为设备自动分配序号，当然，用户也可修改设备序号。需要注意的是，设备的序号为从1开始的自然数，且在一个连接下必须连续且不可重复

## 发布配置

完成上述各种配置后，需将配置发布到对应的Edge设备或服务器上使配置生效。如下图所示：

.. image:: ../../media/publishing_device.png
   :alt: 图：发布配置到盒子

## 通信测试

在用户完成添加连接、添加设备并完成相关配置发布后，可通过通信测试功能测试该连接或端口。点击连接右侧的 |test| 按钮进行测试。

.. |test| image:: ../../media/button_test.png
   :alt: 图：测试按钮

你可以用测试功能查看本连接下各以太网、串口连接的情况，包括以下信息：

- 数据：本连接下的各设备测点的实时数据和处理后的测点数据，用户也可以在数据标签页下使用置数功能
- 原始报文：本连接下的原始通信报文
- 日志：本连接下的通信日志，只显示Warning和Error类型的日志

### 置数

点击 **数据** 标签页的 **置数** ，并设置一个值，点击 **发送** 即可让设备发送该数值作为模拟测点数据至EnOS，置数功能不会打断实时数据的上送，只是在上送数据流中插入一个你设置的数据。

.. |view| image:: ../../media/button_view.png

### 控制台

固化了常用的通信调试命令，包括基本ping测试，本机IP查看，Telnet命令和TCP连接查看命令。

其中，ping测试需在输入框中填写需要ping的IP地址；Telnet测试需填写IP和端口号。

### 单台设备的通信测试

在 **接入管理** 标签页，点击单设备的 |view| 按钮，可对单台设备进行置数测试。此功能与批量通常测试中的置数功能一致，只是这里仅对单台设备进行测试。

.. |view| image:: ../../media/button_view.png

<!--end-->
