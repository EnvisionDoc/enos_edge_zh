# Edge接入配置与调试

在设备模板管理中将设备与对应的设备模板相关联，并配置相应的通信参数，如连接方式是HTTP还是TCP/IP，若为后者则需要配置相应的IP地址和端口号，每条连接下挂载多少设备等。下发配置到盒子端后，若数据有异常，则还需要做一些通信调试工作，以保证数据正确及时的送到云端。

在导航菜单中选择接入中心，会打开接入中心页面，可以看到本客户下的所有场站，选择目标场站，点击接入配置按钮进入该场站的接入配置页面，如下图所示：

.. image:: media/image008.png
   :alt: 图：接入中心首页


接入配置的典型流程如下图所示：

.. image:: media/image009.png
   :alt: 图：通信配置与调试流程

## 添加盒子

盒子是设备数据接入EnOS™系统的中介，此盒子可能是部署于现场的服务器，也可能是部署于云端的服务器（如AWS中的一台虚机）。拥有合法序列号的盒子（SN码）才能通过EnOS™系统的认证。

在场站的接入配置页面，点击添加盒子按钮，在弹出的对话框中填写盒子名称和SN码，如下图所示：

.. image:: media/image010.png
   :alt: 图：添加盒子


通常一个场站只需一个盒子，对于规模较大的场站，由于其包含的点数较多，而一个盒子能够接入的点数有限，此时会添加多个盒子，系统管理员会根据用户提供的场站点数及采样频率系统告知用户需要几个盒子，每个盒子能够接入多少设备。

## 添加连接

添加完盒子后，下一步即在盒子中添加连接。点击盒子下的添加连接按钮后，会弹出对话框。用户在此对话框中填写连接的名称，选择连接方式，并根据所选连接方式设置连接参数。

如下图示例，盒子作为TCP/IP客户端，因此配置的连接参数即为服务器的IP地址和端口号（通常盒子不会直接连接对端服务器，而是连接EnOS™网关，再由此网关连接对端服务器。因此需由系统管理员提前做好映射工作，并告知用户网关的IP地址和端口号供用户填写）。

.. image:: media/image011.png
   :alt: 图：添加连接示例


.. note:: 根据实际需要，一个盒子下可添加多条连接，根据规约类型及盒子类型选择连接方式。

## 添加设备

添加连接后，下一步工作是向连接中添加设备。如下图所示：

.. image:: media/image012.png
   :alt: 图：向连接中添加设备


**添加设备**

在连接下点击添加设备按钮，会打开如下图所示的页面，选择需要添加的同类设备，并选择需关联的设备模板，保存。

.. note:: 需首先选择同一种设备，此后才能为这些设备选择设备模板，如下图所示：

.. image:: media/image013.png
   :alt: 图：添加设备


**更新设备信息**

若所添加的设备信息需要更新，点击连接下的导出按钮导出设备连接信息表，填写完成后再点击导入以上传此信息表。如下图所示：

.. image:: media/image014.png
   :alt: 图：更新设备信息


.. image:: media/image015.png
   :alt: 图：设备连接信息表


点击设备后的 |016| 按钮可以从连接中删除此设备。若需批量删除设备，则勾选此连接下需要删除的设备，而后点击批量删除按钮即可，如下图所示：

.. image:: media/image017.png
   :alt: 图：批量删除设备


## 配置逻辑地址或偏移量

由于一条连接下接入了多个设备，因此需为每个设备配置其逻辑地址及各类点的偏移量。其配置方法取决于所采用的通信规约及其设置。可以逐个设备进行配置，也可导出设备连接信息表线下配置完成后再导入系统，实现批量配置。

1. 逐个设备进行配置

   点击设备后的 |018| 图标，可对此台设备进行编辑，如下图所示：

   .. image:: media/image019.png
      :alt: 图：逐个设备配置逻辑地址及偏移量


   .. image:: media/image020.png
      :alt: 图：逐个设备配置逻辑地址及偏移量


2. 批量配置

   点击连接下的导出按钮，下载连接信息表填写后，再点击导入按钮上传信息表，如下图所示：

   .. image:: media/image015.png
      :alt: 图：设备连接信息表


.. note:: 导出的表中支持AI，DI，PI，AO，DO，PO偏移量的配置。基本的配置方式为用短划线连接，如0-50，当同时存在多个偏移量时，可用\#隔离，如0-50\#1000-1050。

## 发布配置

完成上述各种配置后，需将配置发布到盒子。点击发布，即可将配置发布到对应的盒子上，并可见发布状态。只有发布后，所做的配置才会生效。如下图所示：

.. image:: media/image021.png
   :alt: 图：发布配置到盒子


## 通信测试

完成并发布到盒子后，还需要检查配置是否正确。在接入配置页面，提供了通信指示灯，当设备在传输层（TCP/IP层）连接正常时，指示灯为绿色，否则为红色。如下图所示：

.. image:: media/image022.png
   :alt: 图：传输层通信中断


.. image:: media/image023.png
   :alt: 图：传输层通信正常


上述通信中断的原因有多种，可能是配置没有下发，可能是配置有误，也可能是场站端的通信有异常等等。为此，需要有进一步的调试来帮助用户定位问题所在。EnOS™提供了通信测试功能以帮助实现此目标。

点击连接下的测试按钮，会进入该连接的批量测试页面，如下图所示：

.. image:: media/image024.png
   :alt: 图：批量测试功能


.. image:: media/image025.png
   :alt: 图：批量通信测试页面


下面分别介绍各功能的含义及用法。

### 概览

.. image:: media/image026.png
   :alt: 图：批量通信测试概览


批量测试页面如下图所示，在最上方的下拉菜单可以切换连接，连接的参数显示与下拉菜单下方：

.. image:: media/image027.png
   :alt: 图：切换连接


点击上方的 **开始/暂停** 按钮，可以启动或暂停通信测试功能。

批量测试提供了4项功能，分别为：数据、原始报文、日志和控制台。通过点击相应的Tab页可以在不同功能间切换，如下图所示：

.. image:: media/image028.png
   :alt: 图：通信测试功能切换


### 数据

可查看本连接下的所有设备，或者筛选所需查看的设备，其在盒子中的采集点数据更新情况。

.. image:: media/image029.png
   :alt: 图：数据功能


同时支持遥测、遥信点的置数功能。点击**添加置数**，可设置数值，点击**发送**后可向云端发送所设置的值。点击一次发送一次，不会终止原始数据的上传，相当于插了一个值送上云端。

.. image:: media/image030.png
   :alt: 图：置数功能


### 原始报文

可查看原始收发报文，报文可复制。

.. image:: media/image031.png
   :alt: 图：原始报文功能


### 日志

为避免信息泛滥，隐藏了info类日志，只显示warn和error类型的日志，用于辅助用户判断通信故障原因。

.. image:: media/image032.png
   :alt: 图：日志功能


### 控制台

固化了常用的通信调试命令，包括基本ping测试，本机IP查看，Telnet命令和TCP连接查看命令。

其中，ping测试需在输入框中填写需要ping的IP地址；Telnet测试需填写IP和端口号。

.. image:: media/image033.png
   :alt: 图：控制台功能


### 单台设备的通信测试

在接入中心，点击单设备的**查看数据**按钮，可对单台设备进行通信测试，查看此设备对应的盒子中的数据。此功能与批量通常测试中的数据功能一致，只是这里仅对单台设备进行测试。

.. image:: media/image034.png
   :alt: 图：单台设备通信测试功能



.. |016| image:: media/image016.png

.. |018| image:: media/image018.png


<!--end-->
